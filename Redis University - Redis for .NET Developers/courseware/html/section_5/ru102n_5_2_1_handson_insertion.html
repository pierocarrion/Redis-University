<style type= text/css>
    .code {font-family: 'courier new', courier; font-weight: bold; font-size: 18px !important;}
</style>

<h1>Hands-On with Object Insertion with Redis OM .NET</h1>

<p>
    In this Hands-On we'll be exploring how to insert objects into Redis with Redis OM .NET.
    You can either create your own project to follow along with and connect a RedisConnectionProvider,
    or you can open <span class="code">/src/section_5/section5.2/section5.2.csproj</span> in your IDE.
</p>

<h2>The state of our Model</h2>

<p>
    You can observe our model as we left it off in the previous section in <span class="code"><i>Model.cs</i></span>. Practically every field is indexed, 
    and the two types that we are going to insert today are the <span class="code">Employee</span> and <span class="code">Sale</span> types. They each have a
    <span class="code">RedisIdField</span> decorated <span class="code">Id</span> field, that will be used for handling the model's id, we'll take a look at what
    that means in a bit. 
</p>
<p>
    Both classes have a <span class="code">StorageType</span> of JSON, meaning they'll be serialized as JSON as they are inserted
    into Redis. The primary difference in the way they are decorated is that the <span class="code">Employee</span> class sets what its index name 
    is, and tells Redis OM what prefixes it's allowed to use when indexing. The <span class="code">Sale</span> class on the other hand allows Redis OM to use its defaults.
</p>

<h2>A Simple Insertion</h2>

<p>
    Inserting an object into Redis OM is simple, you use the <span class="code">IRedisCollection&lt;T&gt;.Insert</span> method. You grab a handle to 
    <span class="code">IRedisCollection&lt;T&gt;</span> by using the <span class="code">RedisCollection&lt;T&gt;</span>, then it's as simple as inserting your objects. Let's try to insert an employee.
</p>

<p>
<pre class="code">
    var employees = provider.RedisCollection<Employee>();
    var employee = new Employee
    {
        Name = "Steve",
        Address = new Address
        {
            StreetAddress = "Main Street",
            PostalCode = "34739",
            Location = new GeoLoc(-81.006, 27.872)
        },
        Sales = new List<string>()
    };
    var key = employees.Insert(employee);
</pre>
</p>

<p>
    Notice how we did not initialize an Id for this employee before we inserted it. If an Id is not provided, one will automatically be
    generated by Redis OM, by default, this will be a <a class="page-link" target="_blank" href="https://github.com/ulid/spec"><i>ULID</i></a> - which is essentially a sortable UUID.
    This will be bound directly to the Id Field in the model. 
</p>
<p>
    Additionally, when you use Insert, it will respond with a key name, which is
    the prefix for the model with the Id added to the end, you can observe these behaviors by simply printing out the key and the id that 
    was generated by the insertion:
</p>

<p>
<pre class="code">
    Console.WriteLine($"Employee Id: {employee.Id}");
    Console.WriteLine($"Key Name: {key}");
</pre>
</p>

<p>
    A sample output for this would be:
</p>

<p>
<pre class="code">
    Employee Id: 01GKMARM1N59CWSVKN4DPV9A6T
    Key Name: Employee:01GKMARM1N59CWSVKN4DPV9A6T
</pre>
</p>

<p>
    Now let's do something slightly different, lets insert a <span class="code">Sale</span> into Redis, but this time we will use the 
    <span class="code">IRedisConnection.Set</span> method, and instead of having Redis OM generate an ID for us, we'll generate one ourself.
</p>

<p>
<pre class="code">
    var sale = new Sale
    {
        Id = Guid.NewGuid().ToString(),
        Address = new Address
        {
            StreetAddress = "Pinewood Ave",
            PostalCode = "10001",
            Location = new GeoLoc( -73.991, 40.753)
        },
        EmployeeId = employee.Id,
        Total = 5000,
    };

    key = provider.Connection.Set(sale, TimeSpan.FromMinutes(5));
    Console.WriteLine($"Sale Id: {sale.Id}");
    Console.WriteLine($"Key Name: {key}");
</pre>
</p>

<p>
    This operates very similarly to how the <span class="code">Insert</span> method did, with the key difference being that since <span class="code">Sale</span>
    leans on the defaults for Redis OM, it uses the fully qualified class name as the key prefix.
</p>
<p>
    Since we provided the ID in the form
    of a freshly generated GUID, Redis OM will not try to generate a ULID for you. Finally, since we added a <span class="code">TimeSpan</span> as our
    second argument, we've ensured that after the allotted time (5 minutes), the key will expire automatically and be removed from Redis.
</p>
<p>
    An example output for this would look like:
</p>

<p>
<pre class="code">
    Sale Id: 161f0348-7557-4d9f-994b-dbb06b500b0e
    Key Name: section5._2.Sale:161f0348-7557-4d9f-994b-dbb06b500b0e
</pre>
</p>